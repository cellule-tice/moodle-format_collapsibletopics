/**
 * AMD module for the collapsible sections feature.
 *
 * @module    format_collapsibletopics
 * @author     Jean-Roch Meurisse
 * @copyright  2018 University of Namur - Cellule TICE
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("format_collapsibletopics/collapsibletopics",["jquery","core/log","core/str"],(function($,log,str){var setState=function(course,toggles,storage){"local"==storage?window.localStorage.setItem("sections-toggle-"+course,JSON.stringify(toggles)):"session"==storage&&window.sessionStorage.setItem("sections-toggle-"+course,JSON.stringify(toggles))};return{init:function(args){log.debug("Format collapsibletopics AMD module initialized"),$(document).ready((function($){var sectiontoggles,storage,keepstateoversession=args.keepstateoversession;storage=1==keepstateoversession?"local":"session",sectiontoggles=function(course,storage){var toggles;return"local"==storage?toggles=window.localStorage.getItem("sections-toggle-"+course):"session"==storage&&(toggles=window.sessionStorage.getItem("sections-toggle-"+course)),null===toggles?{}:JSON.parse(toggles)}(args.course,storage),setTimeout((function(){for(var section in sectiontoggles)section="#collapse-"+parseInt(section),$(section).collapse("show");var currentcontent=$(".section.current a.sectiontoggle").attr("href");$(currentcontent).collapse("show")}),50),$("body").on("click",".expandall",(function(event){event.preventDefault();var target=event.target;$(target).removeClass("expandall").addClass("collapseall").html(M.util.get_string("collapseall","moodle")),$(".sectiontoggle").each((function(index){$("#collapse-"+(index+1)).collapse("show"),sectiontoggles.hasOwnProperty(index+1)||(sectiontoggles[index+1]="true",setState(args.course,sectiontoggles,storage))}))})),$("body").on("click",".collapseall",(function(event){event.preventDefault();var target=event.target;$(target).removeClass("collapseall").addClass("expandall").html(M.util.get_string("expandall","moodle")),$(".sectiontoggle").each((function(index){$("#collapse-"+(index+1)).collapse("hide"),sectiontoggles.hasOwnProperty(index+1)&&(delete sectiontoggles[index+1],setState(args.course,sectiontoggles,storage))}))})),$("#nav-drawer div.media").on("click",(function(event){var href=$(event.target).parent().parent().parent().attr("href");if(-1!=href.lastIndexOf("#section-")){var index=href.substring(href.lastIndexOf("-")+1);$("#collapse-"+index).collapse("show")}})),$(".collapse").on("show.bs.collapse",(function(event){var sectionstringid=$(event.target).attr("id"),sectionid=sectionstringid.substring(sectionstringid.lastIndexOf("-")+1);sectiontoggles.hasOwnProperty(sectionid)||(sectiontoggles[sectionid]="true",setState(args.course,sectiontoggles,storage))})),$(".collapse").on("hide.bs.collapse",(function(event){var sectionstringid=$(event.target).attr("id"),sectionid=sectionstringid.substring(sectionstringid.lastIndexOf("-")+1);sectiontoggles.hasOwnProperty(sectionid)&&(delete sectiontoggles[sectionid],setState(args.course,sectiontoggles,storage))})),$("body").on("click",".togglecompletion button",(function(event){var target=event.target,state=$(target).parent().parent().children('input[name="completionstate"]').val(),section=$(target).closest("li.section"),progressbar=$(section).find(".progress-bar"),oldvalue=parseInt($(progressbar).attr("aria-valuenow")),newvalue=1==state?oldvalue+1:oldvalue-1,total=parseInt($(progressbar).attr("aria-valuemax")),percent=Math.round(newvalue/total*100);$(progressbar).attr("aria-valuenow",newvalue),$(progressbar).attr("style","width: "+percent+"%");var strings=[{key:"progresstotal",component:"completion",param:{complete:newvalue,total:total}}];str.get_strings(strings).then((function(progress){return $(progressbar).attr("data-original-title",progress),!0}))}))}))}}}));

//# sourceMappingURL=collapsibletopics.min.js.map